@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix math: <http://www.w3.org/2000/10/swap/math#> .
@prefix string: <http://www.w3.org/2000/10/swap/string#> .
@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix list: <http://www.w3.org/2000/10/swap/list#> .
@prefix fhir: <http://hl7.org/fhir/> .
@prefix tpl: <http://niche.cs.dal.ca/ui_tpl.n3#> .
@prefix : <http://niche.cs.dal.ca/copd_ui.n3#> .
@base <http://niche.cs.dal.ca/copd_ui.n3> .


# METHOD 1

{	?el a tpl:UiElement ; tpl:hidden true ; ?property ?z .
	
	:code_input rdf:value ?code .
	
	_:x tpl:domainNamespace ?ns^log:uri .
	?property!log:uri string:startsWith ?ns .

	( ?code "_property_" ?property ) string:replace ?output

} => {	?el tpl:output ?output } .


{	?el a tpl:UiElement ; tpl:inputType xsd:numeric ; ?property ?z .
	
	:numeric_input rdf:value ?code .
	
	_:x tpl:domainNamespace ?ns^log:uri .
	?property!log:uri string:startsWith ?ns .

	( ?code "_property_" ?property ) string:replace ?output

} => {	?el tpl:output ?output } .


{	?el a tpl:UiElement ; tpl:inputType xsd:boolean ; ?property ?z .
	
	:bool_input rdf:value ?code .
	
	_:x tpl:domainNamespace ?ns^log:uri .
	?property!log:uri string:startsWith ?ns .

	( ?code "_property_" ?property ) string:replace ?output

} => {	?el tpl:output ?output } .


{	?el a tpl:UiElement ; tpl:structure true ; tpl:elements ?elements .
	
	(?output2
	{
		?elements list:iterate ( ?idx ?element ) .
		?element tpl:output ?output .
		( "_" "$1" ?idx "$2" "_" ) string:concatenation ?repl .
		( ?output "_([a-zA-Z-]*?)([\\d]*)_" ?repl ) string:replace ?output2 .
	}
	?outputs2) log:collectAllIn _:x .

	?elements list:length ?len .
	?outputs2!list:length math:equalTo ?len .

	?el tpl:inProperty ?property ; tpl:lvl_struct ?struct .
	?struct rdf:value ?code ; tpl:separator ?sep .

	( ?outputs2 ?sep ) string:join ?content .

	( ?code "_property_" ?property ) string:replace ?code2 .
	( ?code2 ?content ) string:format ?output3 .

} => {	?el tpl:output ?output3 } .
